-
local cmdadmin = true
local adminbool = nil


-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TextChatService = game:GetService("TextChatService")
local VirtualUser = game:GetService("VirtualUser")

local player = game.Players.LocalPlayer
local displayName = player.DisplayName
local user = player.Name
local offset = math.random(0, 360)

local ownerPlayer = game.Players:FindFirstChild(owner)
local adminNotConnected = {}

-- ;admin
local function admin(targetPlayer)
  if not table.find(Admins, targetPlayer.Name) then
    table.insert(Admins, targetPlayer.Name)
    connectChatListener(targetPlayer) -- Connect chat listener immediately when adding admin
    if index == channel then
      chatMessage(targetPlayer.Name .. ' is now an admin.')
    end
  end
end

-- ;unadmin
local function unadmin(targetPlayer)
  local adminIndex = table.find(Admins, targetPlayer.Name)
  if adminIndex then
    table.remove(Admins, adminIndex)
    if index == channel then
      chatMessage(targetPlayer.Name .. ' is no longer an admin.')
    end
  end
end

-- check chat for cmds
local function connectChatListener(playerpower)
  local connection = playerpower.Chatted:Connect(function(message)
    if playerpower.Name == owner or table.find(Admins, playerpower.Name) then
      if message:sub(1, #prefix) == prefix then
        local command = message:sub(#prefix + 1)
        if command == "status" and cmdstatus and table.find(bots, displayName) then
          chatMessage(displayName .. " (Bot " .. index .. ") is active!")
          wait(2)

        elseif command:sub(1, 6) == "admin " and table.find(bots, displayName) and cmdadmin then
          local adminargs = command:sub(7)
          local targetPlayerforadmin = findPlayerByName(adminargs)

          if targetPlayerforadmin then
            admin(targetPlayerforadmin)
          else
            if index == channel then
              chatMessage("Player not found.")
            end
          end
          wait(2)

        elseif command:sub(1, 8) == "unadmin " and table.find(bots, displayName) and cmdadmin then
          local unadminargs = command:sub(9)
          local targetPlayerforunadmin = findPlayerByName(unadminargs)

          if targetPlayerforunadmin then
            unadmin(targetPlayerforunadmin)
          else
            if index == channel then
              chatMessage("Player not found.")
            end
          end
          wait(2)

-listen to players
player.Chatted:Connect(function(message)

end)

--listen to owner
if ownerPlayer then
  connectChatListener(ownerPlayer)
end

--listen to admins
while adminbool do
  for _, adminName in pairs(adminNotConnected) do
    local adminPlayer = game.Players:FindFirstChild(adminName)
    if adminPlayer then
      connectChatListener(adminPlayer)
      table.remove(adminNotConnected, table.find(adminNotConnected, adminName))
    end
  end
  wait(2)
end

--listen to admins
game.Players.PlayerAdded:Connect(function(player)
  if table.find(Admins, player.Name) then
    connectChatListener(player)
  end
end)
